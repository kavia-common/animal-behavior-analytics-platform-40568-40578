{"is_source_file": true, "format": "Python", "description": "This file defines a WebSocket endpoint using FastAPI for real-time communication, handling client connections, message broadcasting, and heartbeat pings for an animal behavior analytics platform. It manages connected WebSocket clients and provides functions to broadcast behavior events and analytics summaries.", "external_files": ["src.api.models"], "external_methods": ["BehaviorEvent.model_dump", "AnalyticsSummary.model_dump"], "published": ["ws_events", "broadcast_event", "broadcast_analytics_delta"], "classes": [], "methods": [{"name": "_prune(ws: WebSocket)", "description": "Removes a WebSocket connection from the set of clients, ignoring errors if the connection is not present.", "scope": "", "scopeKind": ""}, {"name": "_send_safe(ws: WebSocket, message)", "description": "Sends a JSON message over WebSocket with error handling to prune disconnected clients.", "scope": "", "scopeKind": ""}, {"name": "ws_events(websocket: WebSocket)", "description": "WebSocket endpoint for real-time event and analytics delta streaming, managing connection keep-alive and disconnections.", "scope": "", "scopeKind": ""}, {"name": "broadcast_event(event: BehaviorEvent)", "description": "Broadcasts a BehaviorEvent to all connected WebSocket clients.", "scope": "", "scopeKind": ""}, {"name": "broadcast_analytics_delta(summary: AnalyticsSummary)", "description": "Broadcasts an AnalyticsSummary delta to all connected WebSocket clients.", "scope": "", "scopeKind": ""}], "calls": ["asyncio.wait_for", "websocket.receive_text", "websocket.send_json", "asyncio.sleep", "asyncio.create_task"], "search-terms": ["WebSocket", "FastAPI", "Sockets", "broadcast", "analytics", "BehaviorEvent", "AnalyticsSummary"], "state": 2, "file_id": 16, "knowledge_revision": 58, "git_revision": "f8eb0c46f21f9b549b2193e5b9ca104f87aaa00c", "ctags": [{"_type": "tag", "name": "_clients", "path": "/home/kavia/workspace/code-generation/updated--animal-behavior-analytics-platform-animal-behavior-analytics-platform-40568-40578-40605/backend_fastapi/src/api/sockets.py", "pattern": "/^_clients: Set[WebSocket] = set()$/", "language": "Python", "typeref": "typename:Set[WebSocket]", "kind": "variable"}, {"_type": "tag", "name": "_prune", "path": "/home/kavia/workspace/code-generation/updated--animal-behavior-analytics-platform-animal-behavior-analytics-platform-40568-40578-40605/backend_fastapi/src/api/sockets.py", "pattern": "/^def _prune(ws: WebSocket):$/", "language": "Python", "kind": "function", "signature": "(ws: WebSocket)"}, {"_type": "tag", "name": "_send_safe", "path": "/home/kavia/workspace/code-generation/updated--animal-behavior-analytics-platform-animal-behavior-analytics-platform-40568-40578-40605/backend_fastapi/src/api/sockets.py", "pattern": "/^async def _send_safe(ws: WebSocket, message):$/", "language": "Python", "kind": "function", "signature": "(ws: WebSocket, message)"}, {"_type": "tag", "name": "broadcast_analytics_delta", "path": "/home/kavia/workspace/code-generation/updated--animal-behavior-analytics-platform-animal-behavior-analytics-platform-40568-40578-40605/backend_fastapi/src/api/sockets.py", "pattern": "/^def broadcast_analytics_delta(summary: AnalyticsSummary):$/", "language": "Python", "kind": "function", "signature": "(summary: AnalyticsSummary)"}, {"_type": "tag", "name": "broadcast_event", "path": "/home/kavia/workspace/code-generation/updated--animal-behavior-analytics-platform-animal-behavior-analytics-platform-40568-40578-40605/backend_fastapi/src/api/sockets.py", "pattern": "/^def broadcast_event(event: BehaviorEvent):$/", "language": "Python", "kind": "function", "signature": "(event: BehaviorEvent)"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/updated--animal-behavior-analytics-platform-animal-behavior-analytics-platform-40568-40578-40605/backend_fastapi/src/api/sockets.py", "pattern": "/^router = APIRouter(tags=[\"Sockets\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "ws_events", "path": "/home/kavia/workspace/code-generation/updated--animal-behavior-analytics-platform-animal-behavior-analytics-platform-40568-40578-40605/backend_fastapi/src/api/sockets.py", "pattern": "/^async def ws_events(websocket: WebSocket):$/", "language": "Python", "kind": "function", "signature": "(websocket: WebSocket)"}], "hash": "517b52053f5d54d39b86591f834ccf75", "format-version": 4, "code-base-name": "frontend_react_js", "filename": "backend_fastapi/src/api/sockets.py", "fields": [{"name": "Set[WebSocket] _clients", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "router = APIRouter(tags=[\"Sockets\"])", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"58": "f8eb0c46f21f9b549b2193e5b9ca104f87aaa00c"}]}