{"is_source_file": true, "format": "Python", "description": "This source file defines a WebSocket endpoint using FastAPI for real-time broadcasting of events and analytics deltas related to animal behavior. It manages clients, handles message reception with heartbeat mechanisms, and provides functions for broadcasting data to all connected clients.", "external_files": ["src.api.models"], "external_methods": ["BehaviorEvent.model_dump()", "AnalyticsSummary.model_dump()"], "published": ["ws_events", "broadcast_event", "broadcast_analytics_delta"], "classes": [], "methods": [{"name": "_prune(ws: WebSocket)", "description": "Removes a WebSocket connection from the set of clients, handling case where it is not present.", "scope": "", "scopeKind": ""}, {"name": "_send_safe(ws: WebSocket, message)", "description": "Sends a JSON message over WebSocket, handling exceptions by pruning the connection.", "scope": "", "scopeKind": ""}, {"name": "ws_events(websocket: WebSocket)", "description": "WebSocket endpoint for clients to connect and receive real-time event and analytics data, maintaining connection via heartbeat pings.", "scope": "", "scopeKind": ""}, {"name": "broadcast_event(event: BehaviorEvent)", "description": "Broadcasts a BehaviorEvent to all connected clients.", "scope": "", "scopeKind": ""}, {"name": "broadcast_analytics_delta(summary: AnalyticsSummary)", "description": "Broadcasts an AnalyticsSummary delta to all connected clients.", "scope": "", "scopeKind": ""}], "calls": ["asyncio.wait_for", "websocket.accept", "websocket.send_json", "asyncio.sleep", "asyncio.create_task", "_send_safe"], "search-terms": ["WebSocketBroadcast", "asyncio", "client management", "behavior event", "analytics delta", "FastAPI WebSocket"], "state": 2, "file_id": 11, "knowledge_revision": 27, "git_revision": "f8eb0c46f21f9b549b2193e5b9ca104f87aaa00c", "ctags": [{"_type": "tag", "name": "_clients", "path": "/home/kavia/workspace/code-generation/animal-behavior-analytics-platform-40568-40578/backend_fastapi/src/api/sockets.py", "pattern": "/^_clients: Set[WebSocket] = set()$/", "language": "Python", "typeref": "typename:Set[WebSocket]", "kind": "variable"}, {"_type": "tag", "name": "_prune", "path": "/home/kavia/workspace/code-generation/animal-behavior-analytics-platform-40568-40578/backend_fastapi/src/api/sockets.py", "pattern": "/^def _prune(ws: WebSocket):$/", "language": "Python", "kind": "function", "signature": "(ws: WebSocket)"}, {"_type": "tag", "name": "_send_safe", "path": "/home/kavia/workspace/code-generation/animal-behavior-analytics-platform-40568-40578/backend_fastapi/src/api/sockets.py", "pattern": "/^async def _send_safe(ws: WebSocket, message):$/", "language": "Python", "kind": "function", "signature": "(ws: WebSocket, message)"}, {"_type": "tag", "name": "broadcast_analytics_delta", "path": "/home/kavia/workspace/code-generation/animal-behavior-analytics-platform-40568-40578/backend_fastapi/src/api/sockets.py", "pattern": "/^def broadcast_analytics_delta(summary: AnalyticsSummary):$/", "language": "Python", "kind": "function", "signature": "(summary: AnalyticsSummary)"}, {"_type": "tag", "name": "broadcast_event", "path": "/home/kavia/workspace/code-generation/animal-behavior-analytics-platform-40568-40578/backend_fastapi/src/api/sockets.py", "pattern": "/^def broadcast_event(event: BehaviorEvent):$/", "language": "Python", "kind": "function", "signature": "(event: BehaviorEvent)"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/animal-behavior-analytics-platform-40568-40578/backend_fastapi/src/api/sockets.py", "pattern": "/^router = APIRouter(tags=[\"Sockets\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "ws_events", "path": "/home/kavia/workspace/code-generation/animal-behavior-analytics-platform-40568-40578/backend_fastapi/src/api/sockets.py", "pattern": "/^async def ws_events(websocket: WebSocket):$/", "language": "Python", "kind": "function", "signature": "(websocket: WebSocket)"}], "hash": "517b52053f5d54d39b86591f834ccf75", "format-version": 4, "code-base-name": "backend_fastapi", "filename": "backend_fastapi/src/api/sockets.py", "fields": [{"name": "Set[WebSocket] _clients", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "router = APIRouter(tags=[\"Sockets\"])", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"27": "f8eb0c46f21f9b549b2193e5b9ca104f87aaa00c"}]}